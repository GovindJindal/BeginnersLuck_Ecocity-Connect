<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoCity Connect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .nav-link {
            transition: color 0.2s;
        }
        .nav-link:hover {
            color: #10B981; /* A nice green for hover */
        }
        #map, #safetymap {
            height: 450px;
            border-radius: 0.75rem;
        }
        /* Custom styles for the calculator tabs */
        .tab-btn {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.3s, color 0.3s;
        }
        .tab-btn.active {
            background-color: #10B981;
            color: white;
        }
        .tab-btn:not(.active) {
            background-color: #e5e7eb;
            color: #4b5563;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: grid;
        }
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-gray-800">
                <span class="text-emerald-500">Eco</span>City Connect
            </a>
            <div class="hidden md:flex space-x-6">
                <a href="#transport" class="nav-link text-gray-600">Transport</a>
                <a href="#waste" class="nav-link text-gray-600">Waste</a>
                <a href="#safety" class="nav-link text-gray-600">Safety</a>
                <a href="#carbon" class="nav-link text-gray-600">Carbon Footprint</a>
                <a href="#feedback" class="nav-link text-gray-600">Feedback</a>
            </div>
            <button class="md:hidden" id="mobile-menu-button">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </nav>
        <!-- Mobile Menu -->
        <div class="hidden md:hidden" id="mobile-menu">
            <a href="#transport" class="block py-2 px-4 text-sm hover:bg-gray-100">Transport</a>
            <a href="#waste" class="block py-2 px-4 text-sm hover:bg-gray-100">Waste</a>
            <a href="#safety" class="block py-2 px-4 text-sm hover:bg-gray-100">Safety</a>
            <a href="#carbon" class="block py-2 px-4 text-sm hover:bg-gray-100">Carbon Footprint</a>
            <a href="#feedback" class="block py-2 px-4 text-sm hover:bg-gray-100">Feedback</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-12">
        <section class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-bold mb-4">Smart Services for a Sustainable City</h1>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto">Real-time insights into your city's public services to help you live smarter and greener.</p>
        </section>

        <!-- Services Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Public Transport -->
            <div id="transport" class="card p-6 col-span-1 md:col-span-2 lg:col-span-3">
                <h2 class="text-2xl font-bold mb-4">Real-time Public Transport</h2>
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-grow" id="map"></div>
                    <div class="md:w-1/3 lg:w-1/4 bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-bold text-lg mb-2">Live Status</h3>
                        <div id="transport-status-list" class="space-y-3">
                            <p class="text-gray-500">Simulating live vehicle data...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Waste Collection -->
            <div id="waste" class="card p-6">
                <h2 class="text-2xl font-bold mb-4">Waste Collection Schedules</h2>
                <p class="text-gray-600 mb-4">Find your neighborhood's collection days. Based on general MCD schedules.</p>
                <div class="flex space-x-2">
                    <input type="text" id="neighborhood-input" placeholder="e.g., Karol Bagh, Saket" class="flex-grow p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500">
                    <button id="search-waste-btn" class="bg-emerald-500 text-white px-4 py-2 rounded-lg hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-500">Search</button>
                </div>
                <div id="waste-results" class="mt-4 p-4 bg-gray-50 rounded-lg min-h-[100px]">
                     <p class="text-gray-500">Enter a neighborhood to see the schedule.</p>
                </div>
            </div>

            <!-- Safe Route Planner -->
            <div id="safety" class="card p-6 col-span-1 md:col-span-1 lg:col-span-2">
                <h2 class="text-2xl font-bold mb-4">Safe Route Planner</h2>
                <p class="text-gray-600 mb-4">Discover safe, well-lit routes for walking and cycling in your area.</p>
                <div id="safetymap"></div>
            </div>

            <!-- Carbon Footprint Calculator -->
            <div id="carbon" class="card p-6 col-span-1 md:col-span-2 lg:col-span-3">
                <h2 class="text-2xl font-bold mb-4">Carbon Footprint Calculator</h2>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <!-- Tabs -->
                    <div class="flex space-x-2 mb-4">
                        <button class="tab-btn active" data-tab="commute">Commute</button>
                        <button class="tab-btn" data-tab="energy">Domestic Energy Consumption</button>
                    </div>
                    <!-- Commute Tab Content -->
                    <div id="commute" class="tab-content active grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label for="distance" class="block text-sm font-medium text-gray-700">Daily Commute Distance (km)</label>
                            <input type="number" id="distance" placeholder="e.g., 15" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label for="transport-mode" class="block text-sm font-medium text-gray-700">Mode of Transport</label>
                            <select id="transport-mode" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                                <option value="150">Car (Petrol)</option> <option value="40">Bus</option> <option value="21">Metro</option> <option value="110">Motorbike</option> <option value="0">Cycling</option> <option value="0">Walking</option>
                            </select>
                        </div>
                    </div>
                    <!-- Energy Tab Content -->
                    <div id="energy" class="tab-content grid-cols-1 md:grid-cols-3 gap-6">
                       <div>
                            <label for="electricity" class="block text-sm font-medium text-gray-700">Monthly Electricity (kWh)</label>
                            <input type="number" id="electricity" placeholder="e.g., 250" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                     <div class="mt-6 flex justify-center">
                        <button id="calculate-carbon-btn" class="bg-emerald-500 text-white px-8 py-2 rounded-lg hover:bg-emerald-600">Calculate Total Footprint</button>
                    </div>
                    <div id="carbon-result" class="mt-6 text-center"></div>
                </div>
            </div>

            <!-- Citizen Feedback -->
            <div id="feedback" class="card p-6 col-span-1 md:col-span-2 lg:col-span-3">
                 <h2 class="text-2xl font-bold mb-4">Citizen Feedback</h2>
                <p class="text-gray-600 mb-4">See an issue? Report it here and help us improve our city together.</p>
                <form onsubmit="event.preventDefault(); alert('Thank you! Your report has been submitted.'); this.reset();">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <input type="text" placeholder="Your Name" class="p-2 border border-gray-300 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-emerald-500">
                        <select class="p-2 border border-gray-300 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-emerald-500">
                            <option>Pothole</option> <option>Broken Streetlight</option> <option>Waste Not Collected</option> <option>Other</option>
                        </select>
                    </div>
                    <textarea placeholder="Describe the issue..." rows="4" class="p-2 border border-gray-300 rounded-lg w-full mb-4 focus:outline-none focus:ring-2 focus:ring-emerald-500"></textarea>
                    <button type="submit" class="bg-emerald-500 text-white px-6 py-2 rounded-lg hover:bg-emerald-600">Submit Report</button>
                </form>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-16">
        <div class="container mx-auto px-6 py-8 text-center">
            <p>&copy; 2024 EcoCity Connect. Building sustainable communities together.</p>
        </div>
    </footer>

    <script>
        // Mobile Menu Toggle
        document.getElementById('mobile-menu-button').addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });

        // --- Waste Collection Feature ---
        const neighborhoodInput = document.getElementById('neighborhood-input');
        const searchWasteBtn = document.getElementById('search-waste-btn');
        const wasteResultsDiv = document.getElementById('waste-results');
        const wasteSchedules = {
            "connaught place": { general: "Daily", recycling: "Friday" }, "karol bagh": { general: "Daily", recycling: "Tuesday" }, "saket": { general: "Daily", recycling: "Wednesday" }, "dwarka": { general: "Daily", recycling: "Thursday" }, "greater kailash": { general: "Daily", recycling: "Monday" }, "vasant kunj": { general: "Daily", recycling: "Friday" }, "patel nagar": { general: "Daily", recycling: "Saturday" }, "civil lines": { general: "Daily", recycling: "Wednesday" }, "mayur vihar": { general: "Daily", recycling: "Thursday" }, "hauz khas": { general: "Daily", recycling: "Tuesday" }
        };
        function searchSchedule() {
            const query = neighborhoodInput.value.trim().toLowerCase();
            if (!query) {
                wasteResultsDiv.innerHTML = `<p class="text-red-500">Please enter a neighborhood.</p>`; return;
            }
            const schedule = wasteSchedules[query];
            if (schedule) {
                wasteResultsDiv.innerHTML = `<h3 class="font-bold text-lg">${neighborhoodInput.value.trim()}</h3><p><span class="font-semibold">General Waste:</span> ${schedule.general}</p><p><span class="font-semibold">Recycling:</span> ${schedule.recycling}</p>`;
            } else {
                wasteResultsDiv.innerHTML = `<p class="text-gray-600">Sorry, we don't have schedule information for "${neighborhoodInput.value.trim()}".</p>`;
            }
        }
        searchWasteBtn.addEventListener('click', searchSchedule);
        neighborhoodInput.addEventListener('keyup', (event) => { if (event.key === "Enter") searchSchedule(); });

        // --- Carbon Footprint Calculator ---
        const tabs = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(item => item.classList.remove('active'));
                tab.classList.add('active');
                const target = document.getElementById(tab.dataset.tab);
                tabContents.forEach(content => content.classList.remove('active'));
                target.classList.add('active');
            });
        });
        document.getElementById('calculate-carbon-btn').addEventListener('click', () => {
            const distance = parseFloat(document.getElementById('distance').value) || 0;
            const transportFactor = parseFloat(document.getElementById('transport-mode').value) || 0;
            const electricity = parseFloat(document.getElementById('electricity').value) || 0;
            const carbonResultDiv = document.getElementById('carbon-result');
            
            const electricityFactor = 0.8; // Approx. for India

            const commuteFootprint = (distance * transportFactor * 30) / 1000; // in kg
            const energyFootprint = electricity * electricityFactor; // in kg
            const totalFootprint = commuteFootprint + energyFootprint;
            
            carbonResultDiv.innerHTML = `
                <p class="text-lg">Your estimated monthly footprint is:</p>
                <p class="text-3xl font-bold text-emerald-600">${totalFootprint.toFixed(2)} kg CO₂e</p>
                <div class="mt-2 text-sm text-gray-600">
                    <p>Commute: ${commuteFootprint.toFixed(2)} kg | Domestic Energy: ${energyFootprint.toFixed(2)} kg</p>
                </div>`;
        });

        // --- Leaflet Maps ---
        const delhiCoords = [28.6139, 77.2090];
        var map = L.map('map').setView(delhiCoords, 11);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '©️ OpenStreetMap' }).addTo(map);

        var safetymap = L.map('safetymap').setView(delhiCoords, 12);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: '©️ CARTO', maxZoom: 20 }).addTo(safetymap);

        // --- Transport Simulation ---
        const busIcon = L.icon({ iconUrl: 'https://placehold.co/32x32/f97316/FFFFFF?text=DTC', iconSize: [32, 32], iconAnchor: [16, 16] });
        const metroIcon = L.icon({ iconUrl: 'https://placehold.co/32x32/8b5cf6/FFFFFF?text=M', iconSize: [32, 32], iconAnchor: [16, 16] });
        const stationIcon = L.divIcon({className: 'station-icon', html: '<div class="w-2 h-2 bg-white border border-gray-600 rounded-full"></div>', iconSize: [8, 8]});
        const statusList = document.getElementById('transport-status-list');
        statusList.innerHTML = '';
        
        const routes = [
            { name: "DTC Bus 540", type: "bus", color: "#f97316", icon: busIcon, path: [[28.5562, 77.2410], [28.5800, 77.2500], [28.6139, 77.2090], [28.6568, 77.2183]] },
            { name: "DTC Bus 729", type: "bus", color: "#ea580c", icon: busIcon, path: [[28.7041, 77.1025], [28.6600, 77.1500], [28.6328, 77.2166], [28.5959, 77.2222]]},
            { 
                name: "Metro Yellow Line", type: "metro", color: "#eab308", icon: metroIcon, 
                path: [
                    {name: "Samaypur Badli", coords: [28.7495, 77.1534]}, {name: "Vishwavidyalaya", coords: [28.6917, 77.2128]}, {name: "New Delhi", coords: [28.6420, 77.2215]}, 
                    {name: "Rajiv Chowk", coords: [28.6328, 77.2166]}, {name: "Hauz Khas", coords: [28.5443, 77.2058]}, {name: "HUDA City Centre", coords: [28.4595, 77.0722]}
                ] 
            },
            { 
                name: "Metro Blue Line", type: "metro", color: "#3b82f6", icon: metroIcon, 
                path: [
                    {name: "Dwarka Sector 21", coords: [28.5520, 77.0620]}, {name: "Karol Bagh", coords: [28.6479, 77.1932]}, {name: "Rajiv Chowk", coords: [28.6328, 77.2166]},
                    {name: "Mandi House", coords: [28.6264, 77.2344]}, {name: "Mayur Vihar", coords: [28.6095, 77.2895]}, {name: "Noida Electronic City", coords: [28.6200, 77.3731]}
                ] 
            }
        ];

        routes.forEach(route => {
            const routePathCoords = route.type === 'metro' ? route.path.map(station => station.coords) : route.path;
            L.polyline(routePathCoords, { color: route.color, weight: route.type === 'metro' ? 4 : 3, dashArray: route.type === 'metro' ? '10, 5' : '1' }).addTo(map);
            
            if (route.type === 'metro') {
                route.path.forEach(station => {
                    L.marker(station.coords, {icon: stationIcon}).addTo(map).bindPopup(station.name);
                });
            }

            let marker = L.marker(routePathCoords[0], { icon: route.icon }).addTo(map);
            let statusDiv = document.createElement('div');
            statusDiv.className = 'p-2 bg-white rounded-md shadow-sm';
            statusList.appendChild(statusDiv);

            let progress = 0;
            setInterval(() => {
                progress = (progress + 0.1) % (routePathCoords.length - 1);
                const legIndex = Math.floor(progress);
                const legProgress = progress - legIndex;
                const lat = routePathCoords[legIndex][0] + (routePathCoords[legIndex+1][0] - routePathCoords[legIndex][0]) * legProgress;
                const lng = routePathCoords[legIndex][1] + (routePathCoords[legIndex+1][1] - routePathCoords[legIndex][1]) * legProgress;
                marker.setLatLng([lat, lng]);

                const statuses = ["On Time", "Delayed 5 min", "On Time", "Approaching Station", "On Time"];
                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                marker.bindPopup(`<b>${route.name}</b><br>Status: ${randomStatus}`);
                statusDiv.innerHTML = `<div class="flex items-center"><div class="w-3 h-3 rounded-full mr-2" style="background-color: ${route.color}"></div><div><p class="font-bold">${route.name}</p><p class="text-sm text-gray-600">${randomStatus}</p></div></div>`;
            }, 1000 + Math.random() * 500);
        });

        // --- Safe Routes ---
        const safeRoutes = [
            { name: "Lodhi Garden Loop", path: [[28.5926, 77.2196], [28.5950, 77.2230], [28.5910, 77.2250], [28.5890, 77.2210], [28.5926, 77.2196]] },
            { name: "India Gate - Kartavya Path", path: [[28.6129, 77.2295], [28.6129, 77.2185]] },
            { name: "Hauz Khas Village Lakeside", path: [[28.5539, 77.1944], [28.5515, 77.1953]] },
            { name: "Nehru Park Path", path: [[28.5869, 77.1996], [28.5900, 77.1950]]}
        ];
        safeRoutes.forEach(route => {
            L.polyline(route.path, { color: '#10B981', weight: 5, opacity: 0.9 }).addTo(safetymap).bindPopup(route.name);
        });
    </script>
</body>
</html>